
@{
    ViewBag.Title = "Search";
}
<!DOCTYPE html>
<html lang="zxx" class="no-js">

<head>
    <!-- Mobile Specific Meta -->
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <!-- Favicon-->
    <link rel="shortcut icon" href="img/fav.png">
    <!-- Author Meta -->
    <meta name="author" content="CodePixar">
    <!-- Meta Description -->
    <meta name="description" content="">
    <!-- Meta Keyword -->
    <meta name="keywords" content="">
    <!-- meta character set -->
    <meta charset="UTF-8">
    <!-- Site Title -->
    <title>Karma Shop</title>
    <!--
        CSS
        ============================================= -->
    <link rel="stylesheet" href="~/css/linearicons.css">
    <link rel="stylesheet" href="~/css/font-awesome.min.css">
    <link rel="stylesheet" href="~/css/themify-icons.css">
    <link rel="stylesheet" href="~/css/bootstrap.css">
    <link rel="stylesheet" href="~/css/owl.carousel.css">
    <link rel="stylesheet" href="~/css/nice-select.css">
    <link rel="stylesheet" href="~/css/nouislider.min.css">
    <link rel="stylesheet" href="~/css/ion.rangeSlider.css" />
    <link rel="stylesheet" href="~/css/ion.rangeSlider.skinFlat.css" />
    <link rel="stylesheet" href="~/css/magnific-popup.css">
    <link rel="stylesheet" href="~/css/main.css">
</head>
<body>
    <header style=" margin-bottom: 50px;" class="header_area sticky-header">
        <div class="main_menu">
            <nav class="navbar navbar-expand-lg navbar-light main_box">
                <div class="container">
                    <!-- Brand and toggle get grouped for better mobile display -->
                    <a class="navbar-brand logo_h" href="index.html"><img src="img/logo.png" alt=""></a>
                    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent"
                            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                    <!-- Collect the nav links, forms, and other content for toggling -->
                    <div class="collapse navbar-collapse offset" id="navbarSupportedContent">
                        <ul class="nav navbar-nav menu_nav ml-auto">
                            <li class="nav-item active"><a class="nav-link" href="index.html">Home</a></li>
                            <li class="nav-item submenu dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true"
                                   aria-expanded="false">Shop</a>
                                <ul class="dropdown-menu">
                                    <li class="nav-item"><a class="nav-link" href="category.html">Shop Category</a></li>
                                    <li class="nav-item"><a class="nav-link" href="single-product.html">Product Details</a></li>
                                    <li class="nav-item"><a class="nav-link" href="checkout.html">Product Checkout</a></li>
                                    <li class="nav-item"><a class="nav-link" href="cart.html">Shopping Cart</a></li>
                                    <li class="nav-item"><a class="nav-link" href="confirmation.html">Confirmation</a></li>
                                </ul>
                            </li>
                            <li class="nav-item submenu dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true"
                                   aria-expanded="false">Blog</a>
                                <ul class="dropdown-menu">
                                    <li class="nav-item"><a class="nav-link" href="blog.html">Blog</a></li>
                                    <li class="nav-item"><a class="nav-link" href="single-blog.html">Blog Details</a></li>
                                </ul>
                            </li>
                            <li class="nav-item submenu dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true"
                                   aria-expanded="false">Pages</a>
                                <ul class="dropdown-menu">
                                    <li class="nav-item"><a class="nav-link" href="login.html">Login</a></li>
                                    <li class="nav-item"><a class="nav-link" href="tracking.html">Tracking</a></li>
                                    <li class="nav-item"><a class="nav-link" href="elements.html">Elements</a></li>
                                </ul>
                            </li>
                            <li class="nav-item"><a class="nav-link" href="contact.html">Contact</a></li>
                        </ul>
                        <ul class="nav navbar-nav navbar-right">
                            <li class="nav-item"><a href="#" class="cart"><span class="ti-bag"></span></a></li>
                            <li class="nav-item">
                                <button class="search"><span class="lnr lnr-magnifier" id="search"></span></button>
                            </li>
                        </ul>
                    </div>
                </div>
            </nav>
        </div>
        <div class="search_input" id="search_input_box">
            <div class="container">
                <form class="d-flex justify-content-between">
                    <input type="text" class="form-control" id="search_input" oninput="debouncedSearch()" placeholder="Search Here">
                </form>
            </div>
        </div>
    </header>
    <div class="" style="margin-top:100px">
        <div class="row" id="product-list">
            <!-- single product -->
            <div class="col-lg-3 col-md-6">
                <div class="single-product">
                    <img class="img-fluid" src="~/image/hinh1.png" alt="">
                    <div class="product-details">
                        <h6>
                            addidas New Hammer sole
                            for Sports person
                        </h6>
                        <div class="price">
                            <h6>$150.00</h6>
                            <h6 class="l-through">$210.00</h6>
                        </div>
                        <div class="prd-bottom">

                            <a href="" class="social-info">
                                <span class="ti-bag"></span>
                                <p class="hover-text">add to bag</p>
                            </a>
                            <a href="" class="social-info">
                                <span class="lnr lnr-heart"></span>
                                <p class="hover-text">Wishlist</p>
                            </a>
                            <a href="" class="social-info">
                                <span class="lnr lnr-sync"></span>
                                <p class="hover-text">compare</p>
                            </a>
                            <a href="" class="social-info">
                                <span class="lnr lnr-move"></span>
                                <p class="hover-text">view more</p>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <script>
        let debounceTimer;

        // Hàm debounce để gọi API
        function debouncedSearch() {
            clearTimeout(debounceTimer);
            debounceTimer = setTimeout(function () {
                const query = document.getElementById("search_input").value;
                if (query) {
                    console.log(query)
                    searchAPI(query);  // Gọi API sau khi người dùng dừng gõ
                }
            }, 500); // Delay 500ms trước khi gọi API (có thể thay đổi giá trị này)
        }

        // Hàm gọi API và hiển thị kết quả
        function searchAPI(query) {
            const encodedQuery = encodeURIComponent(query);
            console.log(encodedQuery)
            fetch("http://localhost:5288/api/Chitietsanpham/Searchsanpham?key=" + encodedQuery)
                .then(response => response.json())
                .then(data => {
                    if (data.ec === 0) {  // Kiểm tra mã trạng thái
                        displayProducts(data.data);  // Gọi hàm hiển thị sản phẩm
                    } else {
                        displayNoProductsFound();
                    }
                })
                .catch(error => {
                    console.error("Error:", error);
                });
        }

        function displayProducts(products) {
            const productContainer = document.getElementById("product-list"); // Đảm bảo có phần tử này trong HTML

            // Xóa tất cả sản phẩm cũ
            productContainer.innerHTML = "";

            // Lặp qua các sản phẩm và tạo HTML cho từng sản phẩm
            products.forEach(product => {
                // Tạo một phần tử cho từng sản phẩm
                const productElement = document.createElement("div");
                productElement.classList.add("col-lg-3", "col-md-6");  // Đảm bảo các lớp phù hợp với bố cục của bạn

                // Thêm HTML của sản phẩm
                productElement.innerHTML = `
            <div class="single-product" onclick="window.location.href='/Home/ChitietSanpham?masanpham=${product.masanpham}&macolor=${encodeURIComponent(1)}&masize=${40}'">
                <img class="img-fluid" src="images/${product.hinhanh}" alt="${product.tensanpham}">
                <div class="product-details">
                    <h6>${product.tensanpham}</h6>
                    <div class="price">
                        <h6>$${product.gia}</h6>
                        <h6 class="l-through">$210.00</h6>  <!-- Nếu bạn có giá cũ, có thể thay $210.00 bằng giá cũ -->
                    </div>
                    <div class="prd-bottom">
                        <a href="#" class="social-info">
                            <span class="ti-bag"></span>
                            <p class="hover-text">Add to bag</p>
                        </a>
                        <a href="#" class="social-info">
                            <span class="lnr lnr-heart"></span>
                            <p class="hover-text">Wishlist</p>
                        </a>
                        <a href="#" class="social-info">
                            <span class="lnr lnr-sync"></span>
                            <p class="hover-text">Compare</p>
                        </a>
                        <a href="#" class="social-info">
                            <span class="lnr lnr-move"></span>
                            <p class="hover-text">View more</p>
                        </a>
                    </div>
                </div>
            </div>
        `;

                // Thêm sản phẩm vào container có lớp row
                productContainer.appendChild(productElement);
            });
        }

        function displayNoProductsFound() {
            const productContainer = document.getElementById("product-list");

            // Xóa tất cả sản phẩm cũ
            productContainer.innerHTML = "";

            // Tạo phần tử <h3> hiển thị thông báo "Không có sản phẩm"
            const noProductsElement = document.createElement("h3");
            noProductsElement.textContent = "Không có sản phẩm";
            noProductsElement.style.textAlign = "center";  // Căn giữa thông báo
            noProductsElement.style.marginTop = "20px";  // Tạo khoảng cách

            // Thêm thông báo vào container
            productContainer.appendChild(noProductsElement);
        }
    </script>

</body>


</html>
